<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>IPython.core.display &mdash; corpkit-docs 1.74 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.74',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="corpkit-docs 1.74 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for IPython.core.display</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Top-level display functions for displaying object in different formats.&quot;&quot;&quot;</span>

<span class="c"># Copyright (c) IPython Development Team.</span>
<span class="c"># Distributed under the terms of the Modified BSD License.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">mimetypes</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">IPython.core.formatters</span> <span class="kn">import</span> <span class="n">_safe_get_formatter_method</span>
<span class="kn">from</span> <span class="nn">IPython.utils.py3compat</span> <span class="kn">import</span> <span class="p">(</span><span class="n">string_types</span><span class="p">,</span> <span class="n">cast_bytes_py2</span><span class="p">,</span> <span class="n">cast_unicode</span><span class="p">,</span>
                                     <span class="n">unicode_type</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">IPython.testing.skipdoctest</span> <span class="kn">import</span> <span class="n">skip_doctest</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;display&#39;</span><span class="p">,</span> <span class="s">&#39;display_pretty&#39;</span><span class="p">,</span> <span class="s">&#39;display_html&#39;</span><span class="p">,</span> <span class="s">&#39;display_markdown&#39;</span><span class="p">,</span>
<span class="s">&#39;display_svg&#39;</span><span class="p">,</span> <span class="s">&#39;display_png&#39;</span><span class="p">,</span> <span class="s">&#39;display_jpeg&#39;</span><span class="p">,</span> <span class="s">&#39;display_latex&#39;</span><span class="p">,</span> <span class="s">&#39;display_json&#39;</span><span class="p">,</span>
<span class="s">&#39;display_javascript&#39;</span><span class="p">,</span> <span class="s">&#39;display_pdf&#39;</span><span class="p">,</span> <span class="s">&#39;DisplayObject&#39;</span><span class="p">,</span> <span class="s">&#39;TextDisplayObject&#39;</span><span class="p">,</span>
<span class="s">&#39;Pretty&#39;</span><span class="p">,</span> <span class="s">&#39;HTML&#39;</span><span class="p">,</span> <span class="s">&#39;Markdown&#39;</span><span class="p">,</span> <span class="s">&#39;Math&#39;</span><span class="p">,</span> <span class="s">&#39;Latex&#39;</span><span class="p">,</span> <span class="s">&#39;SVG&#39;</span><span class="p">,</span> <span class="s">&#39;JSON&#39;</span><span class="p">,</span> <span class="s">&#39;Javascript&#39;</span><span class="p">,</span>
<span class="s">&#39;Image&#39;</span><span class="p">,</span> <span class="s">&#39;clear_output&#39;</span><span class="p">,</span> <span class="s">&#39;set_matplotlib_formats&#39;</span><span class="p">,</span> <span class="s">&#39;set_matplotlib_close&#39;</span><span class="p">,</span>
<span class="s">&#39;publish_display_data&#39;</span><span class="p">]</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># utility functions</span>
<span class="c">#-----------------------------------------------------------------------------</span>

<span class="k">def</span> <span class="nf">_safe_exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check path, but don&#39;t let exceptions raise&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">_merge</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Like update, but merges sub-dicts instead of clobbering at the top level.</span>

<span class="sd">    Updates d1 in-place</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">d2</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">d1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_merge</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d1</span>

<span class="k">def</span> <span class="nf">_display_mimetype</span><span class="p">(</span><span class="n">mimetype</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;internal implementation of all display_foo methods</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mimetype : str</span>
<span class="sd">        The mimetype to be published (e.g. &#39;image/png&#39;)</span>
<span class="sd">    objs : tuple of objects</span>
<span class="sd">        The Python objects to display, or if raw=True raw text data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">mimetype</span><span class="p">:</span> <span class="n">metadata</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
        <span class="c"># turn list of pngdata into list of { &#39;image/png&#39;: pngdata }</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="n">mimetype</span><span class="p">:</span> <span class="n">obj</span><span class="p">}</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span> <span class="p">]</span>
    <span class="n">display</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">raw</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">mimetype</span><span class="p">])</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># Main functions</span>
<span class="c">#-----------------------------------------------------------------------------</span>

<span class="k">def</span> <span class="nf">publish_display_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Publish data and metadata to all frontends.</span>

<span class="sd">    See the ``display_data`` message in the messaging documentation for</span>
<span class="sd">    more details about this message type.</span>

<span class="sd">    The following MIME types are currently implemented:</span>

<span class="sd">    * text/plain</span>
<span class="sd">    * text/html</span>
<span class="sd">    * text/markdown</span>
<span class="sd">    * text/latex</span>
<span class="sd">    * application/json</span>
<span class="sd">    * application/javascript</span>
<span class="sd">    * image/png</span>
<span class="sd">    * image/jpeg</span>
<span class="sd">    * image/svg+xml</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : dict</span>
<span class="sd">        A dictionary having keys that are valid MIME types (like</span>
<span class="sd">        &#39;text/plain&#39; or &#39;image/svg+xml&#39;) and values that are the data for</span>
<span class="sd">        that MIME type. The data itself must be a JSON&#39;able data</span>
<span class="sd">        structure. Minimally all data should have the &#39;text/plain&#39; data,</span>
<span class="sd">        which can be displayed by all frontends. If more than the plain</span>
<span class="sd">        text is given, it is up to the frontend to decide which</span>
<span class="sd">        representation to use.</span>
<span class="sd">    metadata : dict</span>
<span class="sd">        A dictionary for metadata related to the data. This can contain</span>
<span class="sd">        arbitrary key, value pairs that frontends can use to interpret</span>
<span class="sd">        the data. mime-type keys matching those in data can be used</span>
<span class="sd">        to specify metadata about particular representations.</span>
<span class="sd">    source : str, deprecated</span>
<span class="sd">        Unused.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
    <span class="n">InteractiveShell</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">display_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display a Python object in all frontends.</span>

<span class="sd">    By default all representations will be computed and sent to the frontends.</span>
<span class="sd">    Frontends can decide which representation is used and how.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objs : tuple of objects</span>
<span class="sd">        The Python objects to display.</span>
<span class="sd">    raw : bool, optional</span>
<span class="sd">        Are the objects to be displayed already mimetype-keyed dicts of raw display data,</span>
<span class="sd">        or Python objects that need to be formatted before display? [default: False]</span>
<span class="sd">    include : list or tuple, optional</span>
<span class="sd">        A list of format type strings (MIME types) to include in the</span>
<span class="sd">        format data dict. If this is set *only* the format types included</span>
<span class="sd">        in this list will be computed.</span>
<span class="sd">    exclude : list or tuple, optional</span>
<span class="sd">        A list of format type strings (MIME types) to exclude in the format</span>
<span class="sd">        data dict. If this is set all format types will be computed,</span>
<span class="sd">        except for those included in this argument.</span>
<span class="sd">    metadata : dict, optional</span>
<span class="sd">        A dictionary of metadata to associate with the output.</span>
<span class="sd">        mime-type keys in this dictionary will be associated with the individual</span>
<span class="sd">        representation formats, if they exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;raw&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">include</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;include&#39;</span><span class="p">)</span>
    <span class="n">exclude</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;exclude&#39;</span><span class="p">)</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;metadata&#39;</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">InteractiveShell</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">display_formatter</span><span class="o">.</span><span class="n">format</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
            <span class="n">publish_display_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">format_dict</span><span class="p">,</span> <span class="n">md_dict</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">format_dict</span><span class="p">:</span>
                <span class="c"># nothing to display (e.g. _ipython_display_ took over)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
                <span class="c"># kwarg-specified metadata gets precedence</span>
                <span class="n">_merge</span><span class="p">(</span><span class="n">md_dict</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
            <span class="n">publish_display_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">format_dict</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">md_dict</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_pretty</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display the pretty (default) representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objs : tuple of objects</span>
<span class="sd">        The Python objects to display, or if raw=True raw text data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_html</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display the HTML representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objs : tuple of objects</span>
<span class="sd">        The Python objects to display, or if raw=True raw HTML data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s">&#39;text/html&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_markdown</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays the Markdown representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objs : tuple of objects</span>
<span class="sd">        The Python objects to display, or if raw=True raw markdown data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s">&#39;text/markdown&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_svg</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display the SVG representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objs : tuple of objects</span>
<span class="sd">        The Python objects to display, or if raw=True raw svg data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s">&#39;image/svg+xml&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_png</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display the PNG representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objs : tuple of objects</span>
<span class="sd">        The Python objects to display, or if raw=True raw png data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s">&#39;image/png&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_jpeg</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display the JPEG representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objs : tuple of objects</span>
<span class="sd">        The Python objects to display, or if raw=True raw JPEG data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s">&#39;image/jpeg&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_latex</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display the LaTeX representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objs : tuple of objects</span>
<span class="sd">        The Python objects to display, or if raw=True raw latex data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s">&#39;text/latex&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_json</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display the JSON representation of an object.</span>

<span class="sd">    Note that not many frontends support displaying JSON.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objs : tuple of objects</span>
<span class="sd">        The Python objects to display, or if raw=True raw json data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s">&#39;application/json&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_javascript</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display the Javascript representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objs : tuple of objects</span>
<span class="sd">        The Python objects to display, or if raw=True raw javascript data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s">&#39;application/javascript&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_pdf</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display the PDF representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objs : tuple of objects</span>
<span class="sd">        The Python objects to display, or if raw=True raw javascript data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s">&#39;application/pdf&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># Smart classes</span>
<span class="c">#-----------------------------------------------------------------------------</span>


<span class="k">class</span> <span class="nc">DisplayObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An object that wraps data to be displayed.&quot;&quot;&quot;</span>

    <span class="n">_read_flags</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span>
    <span class="n">_show_mem_addr</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a display object given raw data.</span>

<span class="sd">        When this object is returned by an expression or passed to the</span>
<span class="sd">        display function, it will result in the data being displayed</span>
<span class="sd">        in the frontend. The MIME type of the data should match the</span>
<span class="sd">        subclasses used, so the Png subclass should be used for &#39;image/png&#39;</span>
<span class="sd">        data. If the data is a URL, the data will first be downloaded</span>
<span class="sd">        and then displayed. If</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : unicode, str or bytes</span>
<span class="sd">            The raw data or a URL or file to load the data from</span>
<span class="sd">        url : unicode</span>
<span class="sd">            A URL to download the data from.</span>
<span class="sd">        filename : unicode</span>
<span class="sd">            Path to a local file to load the data from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;http&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">url</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">elif</span> <span class="n">_safe_exists</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">and</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">unicode_type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_data</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_mem_addr</span><span class="p">:</span>
            <span class="n">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span>
            <span class="n">r</span> <span class="o">=</span> <span class="s">&quot;&lt;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s"> object&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">DisplayObject</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">_check_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override in subclasses if there&#39;s something to check.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reload the raw data from file or URL.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_flags</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>  <span class="c"># Py3</span>
                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                    <span class="kn">from</span> <span class="nn">urllib2</span> <span class="kn">import</span> <span class="n">urlopen</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="c"># extract encoding from header, if there is one:</span>
                <span class="n">encoding</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">):</span>
                    <span class="n">sub</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">sub</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">):</span>
                        <span class="n">encoding</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">break</span>
                <span class="c"># decode data, if an encoding was specified</span>
                <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">class</span> <span class="nc">TextDisplayObject</span><span class="p">(</span><span class="n">DisplayObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate that display data is text&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_check_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> expects text, not </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Pretty</span><span class="p">(</span><span class="n">TextDisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>


<span class="k">class</span> <span class="nc">HTML</span><span class="p">(</span><span class="n">TextDisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">__html__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method exists to inform other HTML-using modules (e.g. Markupsafe,</span>
<span class="sd">        htmltag, etc) that this object is HTML and does not need things like</span>
<span class="sd">        special characters (&lt;&gt;&amp;) escaped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Markdown</span><span class="p">(</span><span class="n">TextDisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_repr_markdown_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>


<span class="k">class</span> <span class="nc">Math</span><span class="p">(</span><span class="n">TextDisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_repr_latex_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;$&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;$$</span><span class="si">%s</span><span class="s">$$&quot;</span> <span class="o">%</span> <span class="n">s</span>


<span class="k">class</span> <span class="nc">Latex</span><span class="p">(</span><span class="n">TextDisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_repr_latex_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>


<span class="k">class</span> <span class="nc">SVG</span><span class="p">(</span><span class="n">DisplayObject</span><span class="p">):</span>

    <span class="c"># wrap data in a property, which extracts the &lt;svg&gt; tag, discarding</span>
    <span class="c"># document headers</span>
    <span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@data.setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">svg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">svg</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span>
        <span class="c"># parse into dom object</span>
        <span class="kn">from</span> <span class="nn">xml.dom</span> <span class="kn">import</span> <span class="n">minidom</span>
        <span class="n">svg</span> <span class="o">=</span> <span class="n">cast_bytes_py2</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>
        <span class="c"># get svg tag (should be 1)</span>
        <span class="n">found_svg</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s">&#39;svg&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">found_svg</span><span class="p">:</span>
            <span class="n">svg</span> <span class="o">=</span> <span class="n">found_svg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">toxml</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># fallback on the input, trust the user</span>
            <span class="c"># but this is probably an error.</span>
            <span class="k">pass</span>
        <span class="n">svg</span> <span class="o">=</span> <span class="n">cast_unicode</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">svg</span>

    <span class="k">def</span> <span class="nf">_repr_svg_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>


<span class="k">class</span> <span class="nc">JSON</span><span class="p">(</span><span class="n">DisplayObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;JSON expects a JSON-able dict or list</span>
<span class="sd">    </span>
<span class="sd">    not an already-serialized JSON string.</span>
<span class="sd">    </span>
<span class="sd">    Scalar types (None, number, string) are not allowed, only dict or list containers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># wrap data in a property, which warns about passing already-serialized JSON</span>
    <span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">_check_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> expects JSONable dict or list, not </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
    
    <span class="nd">@data.setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;JSON expects JSONable dict or list, not JSON strings&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_repr_json_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

<span class="n">css_t</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;$(&quot;head&quot;).append($(&quot;&lt;link/&gt;&quot;).attr({</span>
<span class="s">  rel:  &quot;stylesheet&quot;,</span>
<span class="s">  type: &quot;text/css&quot;,</span>
<span class="s">  href: &quot;</span><span class="si">%s</span><span class="s">&quot;</span>
<span class="s">}));</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="n">lib_t1</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;$.getScript(&quot;</span><span class="si">%s</span><span class="s">&quot;, function () {</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="n">lib_t2</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;});</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">Javascript</span><span class="p">(</span><span class="n">TextDisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lib</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a Javascript display object given raw data.</span>

<span class="sd">        When this object is returned by an expression or passed to the</span>
<span class="sd">        display function, it will result in the data being displayed</span>
<span class="sd">        in the frontend. If the data is a URL, the data will first be</span>
<span class="sd">        downloaded and then displayed.</span>

<span class="sd">        In the Notebook, the containing element will be available as `element`,</span>
<span class="sd">        and jQuery will be available.  Content appended to `element` will be</span>
<span class="sd">        visible in the output area. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : unicode, str or bytes</span>
<span class="sd">            The Javascript source code or a URL to download it from.</span>
<span class="sd">        url : unicode</span>
<span class="sd">            A URL to download the data from.</span>
<span class="sd">        filename : unicode</span>
<span class="sd">            Path to a local file to load the data from.</span>
<span class="sd">        lib : list or str</span>
<span class="sd">            A sequence of Javascript library URLs to load asynchronously before</span>
<span class="sd">            running the source code. The full URLs of the libraries should</span>
<span class="sd">            be given. A single Javascript library URL can also be given as a</span>
<span class="sd">            string.</span>
<span class="sd">        css: : list or str</span>
<span class="sd">            A sequence of css files to load before running the source code.</span>
<span class="sd">            The full URLs of the css files should be given. A single css URL</span>
<span class="sd">            can also be given as a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="n">lib</span> <span class="o">=</span> <span class="p">[</span><span class="n">lib</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">lib</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">lib</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">css</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="n">css</span> <span class="o">=</span> <span class="p">[</span><span class="n">css</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">css</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">css</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;expected sequence, got: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">lib</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">css</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;expected sequence, got: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">css</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">lib</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">css</span> <span class="o">=</span> <span class="n">css</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Javascript</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_javascript_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">+=</span> <span class="n">css_t</span> <span class="o">%</span> <span class="n">c</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">+=</span> <span class="n">lib_t1</span> <span class="o">%</span> <span class="n">l</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="n">lib_t2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span>

<span class="c"># constants for identifying png/jpeg data</span>
<span class="n">_PNG</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x89</span><span class="s">PNG</span><span class="se">\r\n\x1a\n</span><span class="s">&#39;</span>
<span class="n">_JPEG</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xd8</span><span class="s">&#39;</span>

<span class="k">def</span> <span class="nf">_pngxy</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;read the (width, height) from a PNG header&quot;&quot;&quot;</span>
    <span class="n">ihdr</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;IHDR&#39;</span><span class="p">)</span>
    <span class="c"># next 8 bytes are width/height</span>
    <span class="n">w4h4</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ihdr</span><span class="o">+</span><span class="mi">4</span><span class="p">:</span><span class="n">ihdr</span><span class="o">+</span><span class="mi">12</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;ii&#39;</span><span class="p">,</span> <span class="n">w4h4</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_jpegxy</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;read the (width, height) from a JPEG header&quot;&quot;&quot;</span>
    <span class="c"># adapted from http://www.64lines.com/jpeg-width-height</span>
    
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">block_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="n">block_size</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xFF\xC0</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="c"># found Start of Frame</span>
            <span class="n">iSOF</span> <span class="o">=</span> <span class="n">idx</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># read another block</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;HH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">iSOF</span><span class="o">+</span><span class="mi">5</span><span class="p">:</span><span class="n">iSOF</span><span class="o">+</span><span class="mi">9</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span>

<span class="k">class</span> <span class="nc">Image</span><span class="p">(</span><span class="n">DisplayObject</span><span class="p">):</span>

    <span class="n">_read_flags</span> <span class="o">=</span> <span class="s">&#39;rb&#39;</span>
    <span class="n">_FMT_JPEG</span> <span class="o">=</span> <span class="s">u&#39;jpeg&#39;</span>
    <span class="n">_FMT_PNG</span> <span class="o">=</span> <span class="s">u&#39;png&#39;</span>
    <span class="n">_ACCEPTABLE_EMBEDDINGS</span> <span class="o">=</span> <span class="p">[</span><span class="n">_FMT_JPEG</span><span class="p">,</span> <span class="n">_FMT_PNG</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">u&#39;png&#39;</span><span class="p">,</span>
                 <span class="n">embed</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">retina</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">unconfined</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a PNG/JPEG image object given raw data.</span>

<span class="sd">        When this object is returned by an input cell or passed to the</span>
<span class="sd">        display function, it will result in the image being displayed</span>
<span class="sd">        in the frontend.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : unicode, str or bytes</span>
<span class="sd">            The raw image data or a URL or filename to load the data from.</span>
<span class="sd">            This always results in embedded image data.</span>
<span class="sd">        url : unicode</span>
<span class="sd">            A URL to download the data from. If you specify `url=`,</span>
<span class="sd">            the image data will not be embedded unless you also specify `embed=True`.</span>
<span class="sd">        filename : unicode</span>
<span class="sd">            Path to a local file to load the data from.</span>
<span class="sd">            Images from a file are always embedded.</span>
<span class="sd">        format : unicode</span>
<span class="sd">            The format of the image data (png/jpeg/jpg). If a filename or URL is given</span>
<span class="sd">            for format will be inferred from the filename extension.</span>
<span class="sd">        embed : bool</span>
<span class="sd">            Should the image data be embedded using a data URI (True) or be</span>
<span class="sd">            loaded using an &lt;img&gt; tag. Set this to True if you want the image</span>
<span class="sd">            to be viewable later with no internet connection in the notebook.</span>

<span class="sd">            Default is `True`, unless the keyword argument `url` is set, then</span>
<span class="sd">            default value is `False`.</span>

<span class="sd">            Note that QtConsole is not able to display images if `embed` is set to `False`</span>
<span class="sd">        width : int</span>
<span class="sd">            Width to which to constrain the image in html</span>
<span class="sd">        height : int</span>
<span class="sd">            Height to which to constrain the image in html</span>
<span class="sd">        retina : bool</span>
<span class="sd">            Automatically set the width and height to half of the measured</span>
<span class="sd">            width and height.</span>
<span class="sd">            This only works for embedded images because it reads the width/height</span>
<span class="sd">            from image data.</span>
<span class="sd">            For non-embedded images, you can just set the desired display width</span>
<span class="sd">            and height directly.</span>
<span class="sd">        unconfined: bool</span>
<span class="sd">            Set unconfined=True to disable max-width confinement of the image.</span>
<span class="sd">        metadata: dict</span>
<span class="sd">            Specify extra metadata to attach to the image.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        # embedded image data, works in qtconsole and notebook</span>
<span class="sd">        # when passed positionally, the first arg can be any of raw image data,</span>
<span class="sd">        # a URL, or a filename from which to load image data.</span>
<span class="sd">        # The result is always embedding image data for inline images.</span>
<span class="sd">        Image(&#39;http://www.google.fr/images/srpr/logo3w.png&#39;)</span>
<span class="sd">        Image(&#39;/path/to/image.jpg&#39;)</span>
<span class="sd">        Image(b&#39;RAW_PNG_DATA...&#39;)</span>

<span class="sd">        # Specifying Image(url=...) does not embed the image data,</span>
<span class="sd">        # it only generates `&lt;img&gt;` tag with a link to the source.</span>
<span class="sd">        # This will not work in the qtconsole or offline.</span>
<span class="sd">        Image(url=&#39;http://www.google.fr/images/srpr/logo3w.png&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_ext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_ext</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;No image data found. Expecting filename, url, or data.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">string_types</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;http&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_safe_exists</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_ext</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">format</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">u&#39;jpg&#39;</span> <span class="ow">or</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">u&#39;jpeg&#39;</span><span class="p">:</span>
                <span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FMT_JPEG</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">u&#39;png&#39;</span><span class="p">:</span>
                <span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FMT_PNG</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;png&#39;</span><span class="p">:</span>
            <span class="c"># infer image type from image data header,</span>
            <span class="c"># only if format might not have been specified.</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">_JPEG</span><span class="p">:</span>
                <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;jpeg&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">unicode_type</span><span class="p">(</span><span class="n">format</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="o">=</span> <span class="n">embed</span> <span class="k">if</span> <span class="n">embed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">url</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ACCEPTABLE_EMBEDDINGS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Cannot embed the &#39;</span><span class="si">%s</span><span class="s">&#39; image format&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retina</span> <span class="o">=</span> <span class="n">retina</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unconfined</span> <span class="o">=</span> <span class="n">unconfined</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Image</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">retina</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_retina_shape</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_retina_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;load pixel-doubled width and height from image data&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s">&#39;png&#39;</span><span class="p">:</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">_pngxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s">&#39;jpeg&#39;</span><span class="p">:</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">_jpegxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># retina only supports png</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">w</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reload the raw data from file or URL.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Image</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">retina</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_retina_shape</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">height</span> <span class="o">=</span> <span class="n">klass</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">=</span> <span class="s">&#39; width=&quot;</span><span class="si">%d</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">:</span>
                <span class="n">height</span> <span class="o">=</span> <span class="s">&#39; height=&quot;</span><span class="si">%d</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unconfined</span><span class="p">:</span>
                <span class="n">klass</span> <span class="o">=</span> <span class="s">&#39; class=&quot;unconfined&quot;&#39;</span>
            <span class="k">return</span> <span class="s">u&#39;&lt;img src=&quot;{url}&quot;{width}{height}{klass}/&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                <span class="n">klass</span><span class="o">=</span><span class="n">klass</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_data_and_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;shortcut for returning metadata with shape information, if defined&quot;&quot;&quot;</span>
        <span class="n">md</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
            <span class="n">md</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">:</span>
            <span class="n">md</span><span class="p">[</span><span class="s">&#39;height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unconfined</span><span class="p">:</span>
            <span class="n">md</span><span class="p">[</span><span class="s">&#39;unconfined&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unconfined</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
            <span class="n">md</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">md</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">md</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">_repr_png_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s">u&#39;png&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_and_metadata</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_repr_jpeg_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s">u&#39;jpeg&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s">u&#39;jpg&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_and_metadata</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_find_ext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unicode_type</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">Video</span><span class="p">(</span><span class="n">DisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a video object given raw data or an URL.</span>

<span class="sd">        When this object is returned by an input cell or passed to the</span>
<span class="sd">        display function, it will result in the video being displayed</span>
<span class="sd">        in the frontend.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : unicode, str or bytes</span>
<span class="sd">            The raw image data or a URL or filename to load the data from.</span>
<span class="sd">            This always results in embedded image data.</span>
<span class="sd">        url : unicode</span>
<span class="sd">            A URL to download the data from. If you specify `url=`,</span>
<span class="sd">            the image data will not be embedded unless you also specify `embed=True`.</span>
<span class="sd">        filename : unicode</span>
<span class="sd">            Path to a local file to load the data from.</span>
<span class="sd">            Videos from a file are always embedded.</span>
<span class="sd">        embed : bool</span>
<span class="sd">            Should the image data be embedded using a data URI (True) or be</span>
<span class="sd">            loaded using an &lt;img&gt; tag. Set this to True if you want the image</span>
<span class="sd">            to be viewable later with no internet connection in the notebook.</span>

<span class="sd">            Default is `True`, unless the keyword argument `url` is set, then</span>
<span class="sd">            default value is `False`.</span>

<span class="sd">            Note that QtConsole is not able to display images if `embed` is set to `False`</span>
<span class="sd">        mimetype: unicode</span>
<span class="sd">            Specify the mimetype in case you load in a encoded video.</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Video(&#39;https://archive.org/download/Sita_Sings_the_Blues/Sita_Sings_the_Blues_small.mp4&#39;)</span>
<span class="sd">        Video(&#39;path/to/video.mp4&#39;)</span>
<span class="sd">        Video(&#39;path/to/video.mp4&#39;, embed=False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;http&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;https&#39;</span><span class="p">)):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">embed</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mimetype</span> <span class="o">=</span> <span class="n">mimetype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="o">=</span> <span class="n">embed</span> <span class="k">if</span> <span class="n">embed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Video</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># External URLs and potentially local files are not embedded into the</span>
        <span class="c"># notebook output.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
            <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;video src=&quot;{0}&quot; controls&gt;</span>
<span class="s">      Your browser does not support the &lt;code&gt;video&lt;/code&gt; element.</span>
<span class="s">    &lt;/video&gt;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">output</span>
        <span class="c"># Embedded videos uses base64 encoded videos.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mimetypes</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
            <span class="n">mimetype</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

            <span class="n">video</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">video_encoded</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;base64&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">video_encoded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="n">mimetype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mimetype</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;video controls&gt;</span>
<span class="s"> &lt;source src=&quot;data:{0};base64,{1}&quot; type=&quot;{0}&quot;&gt;</span>
<span class="s"> Your browser does not support the video tag.</span>
<span class="s"> &lt;/video&gt;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mimetype</span><span class="p">,</span> <span class="n">video_encoded</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_repr_png_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">_repr_jpeg_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>

<span class="k">def</span> <span class="nf">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clear the output of the current cell receiving output.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wait : bool [default: false]</span>
<span class="sd">        Wait to clear the output until new output is available to replace it.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
    <span class="k">if</span> <span class="n">InteractiveShell</span><span class="o">.</span><span class="n">initialized</span><span class="p">():</span>
        <span class="n">InteractiveShell</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">display_pub</span><span class="o">.</span><span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">IPython.utils</span> <span class="kn">import</span> <span class="n">io</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\033</span><span class="s">[2K</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">io</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\033</span><span class="s">[2K</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">io</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>


<span class="nd">@skip_doctest</span>
<span class="k">def</span> <span class="nf">set_matplotlib_formats</span><span class="p">(</span><span class="o">*</span><span class="n">formats</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Select figure formats for the inline backend. Optionally pass quality for JPEG.</span>

<span class="sd">    For example, this enables PNG and JPEG output with a JPEG quality of 90%::</span>

<span class="sd">        In [1]: set_matplotlib_formats(&#39;png&#39;, &#39;jpeg&#39;, quality=90)</span>

<span class="sd">    To set this in your config files use the following::</span>
<span class="sd">    </span>
<span class="sd">        c.InlineBackend.figure_formats = {&#39;png&#39;, &#39;jpeg&#39;}</span>
<span class="sd">        c.InlineBackend.print_figure_kwargs.update({&#39;quality&#39; : 90})</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *formats : strs</span>
<span class="sd">        One or more figure formats to enable: &#39;png&#39;, &#39;retina&#39;, &#39;jpeg&#39;, &#39;svg&#39;, &#39;pdf&#39;.</span>
<span class="sd">    **kwargs :</span>
<span class="sd">        Keyword args will be relayed to ``figure.canvas.print_figure``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
    <span class="kn">from</span> <span class="nn">IPython.core.pylabtools</span> <span class="kn">import</span> <span class="n">select_figure_formats</span>
    <span class="c"># build kwargs, starting with InlineBackend config</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="kn">from</span> <span class="nn">ipykernel.pylab.config</span> <span class="kn">import</span> <span class="n">InlineBackend</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">InlineBackend</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
    <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">print_figure_kwargs</span><span class="p">)</span>
    <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">shell</span> <span class="o">=</span> <span class="n">InteractiveShell</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
    <span class="n">select_figure_formats</span><span class="p">(</span><span class="n">shell</span><span class="p">,</span> <span class="n">formats</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="nd">@skip_doctest</span>
<span class="k">def</span> <span class="nf">set_matplotlib_close</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set whether the inline backend closes all figures automatically or not.</span>
<span class="sd">    </span>
<span class="sd">    By default, the inline backend used in the IPython Notebook will close all</span>
<span class="sd">    matplotlib figures automatically after each cell is run. This means that</span>
<span class="sd">    plots in different cells won&#39;t interfere. Sometimes, you may want to make</span>
<span class="sd">    a plot in one cell and then refine it in later cells. This can be accomplished</span>
<span class="sd">    by::</span>
<span class="sd">    </span>
<span class="sd">        In [1]: set_matplotlib_close(False)</span>
<span class="sd">    </span>
<span class="sd">    To set this in your config files use the following::</span>
<span class="sd">    </span>
<span class="sd">        c.InlineBackend.close_figures = False</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    close : bool</span>
<span class="sd">        Should all matplotlib figures be automatically closed after each cell is</span>
<span class="sd">        run?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ipykernel.pylab.config</span> <span class="kn">import</span> <span class="n">InlineBackend</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">InlineBackend</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">close_figures</span> <span class="o">=</span> <span class="n">close</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">corpkit-docs</a></h1>





<p>
<iframe src="https://ghbtns.com/github-btn.html?user=&repo=&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../corpkit.html">corpkit package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Daniel McDonald.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>